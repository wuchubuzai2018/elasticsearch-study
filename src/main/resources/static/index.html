<html !DOCTYPE>
    <head>
        <title>ElasticSearch学习页面</title>
        <meta charset="UTF-8"/>
        <link rel="stylesheet" href="./js/element-ui/index.css"/>
        <style type="text/css">
            #app .top{
                height:60px;
                line-height:60px;
                padding-left:20px;
                font-size:20px;
                color:#FFF;
                background-color: #545c64;
            }
        </style>
        <script type="text/javascript" src="./js/vue.min.js"></script>
        <script type="text/javascript" src="./js/element-ui/index.js"></script>
        <script type="text/javascript" src="./js/axios.min.js"></script>
    </head>
    <body>
        <div id="app">
            <el-container v-loading="vloading">
                <el-header class="top">
                    Vue+ElasticSearch主页面
                </el-header>
                <el-main>
                    <el-row>
                        <el-alert title="进度" type="info"
                                  description="目前实现爬取80s上的电影信息、分页查询、全部删除(暂时不清楚如何删除全部数据,底层好像有限制)" show-icon>
                        </el-alert>
                    </el-row>
                    <el-row>
                        <el-button type="primary" size="mini" @click="queryDataForPage">查询</el-button>
                        <el-button type="primary" size="mini" @click="startGetMovie">开始爬取</el-button>
                        <el-button type="primary" size="mini" @click="deleteAllMovie">删除所有</el-button>
                    </el-row>
                    <el-table size="mini" :data="tableData" style="width: 100%" height="450" stripe border>
                        <el-table-column prop="movieId" label="电影ID" width="70"></el-table-column>
                        <el-table-column prop="movieName" label="电影名称" width="150"></el-table-column>
                        <el-table-column prop="tip" label="提示" width="200"></el-table-column>
                        <el-table-column prop="type" label="类型" width="150"></el-table-column>
                        <el-table-column prop="area" label="地区" width="100"></el-table-column>
                        <el-table-column prop="director" label="导演" width="200" show-overflow-tooltip></el-table-column>
                        <el-table-column prop="year" label="年份" width="80"></el-table-column>
                        <el-table-column prop="minute" label="时长" width="80"></el-table-column>
                        <el-table-column prop="score" label="豆瓣评分" width="100"></el-table-column>
                        <el-table-column prop="language" label="语言" width="150"></el-table-column>
                        <el-table-column prop="year" label="年份" width="80"></el-table-column>
                        <el-table-column prop="actors" label="演员" width="1000"  show-overflow-tooltip></el-table-column>
                    </el-table>
                    <div style="text-align: right;">
                        <el-pagination
                                @size-change="handleSizeChange"
                                @current-change="handleCurrentChange"
                                :current-page="currentPage"
                                :page-sizes="[10,50,100, 200, 300, 400]"
                                :page-size="pageSize"
                                layout="total, sizes, prev, pager, next, jumper"
                                :total="totalCount">
                        </el-pagination>
                    </div>
                   
                </el-main>
            </el-container>
        </div>
    </body>
    <script type="text/javascript">
        var vm = new Vue({
            el : '#app',
            data : {
                vloading:false,
                tableData:[],
                showlist : true,
                activeIndex: '1',
                activeIndex2: '1',
                totalCount:0,
                currentPage:1,
                pageSize:10
            },
            methods : {
                add:function(){
                    alert("asd");
                    vm.showlist = false;
                },
                handleSelect:function(key, keyPath){
                    console.log(key, keyPath);
                },
                queryData:function(){
                    var self = this;
                    self.vloading = true;
                    var url = "/movie/getAllMovie";
                    axios.post(url).then(function (response) {
                        self.vloading = false;
                       if(response && response.data && response.data.success){
                           self.tableData = response.data.list;
                       }
                    }).catch(function (error) {
                        self.vloading = false;
                        console.log(error);
                    });
                },
                queryDataForPage:function(){
                    var self = this;
                    self.vloading = true;
                    var url = "/movie/getAllMovieForPage";
                    var params = "page=" + this.currentPage + "&pageSize=" + this.pageSize;
                    axios.post(url,params).then(function (response) {
                        self.vloading = false;
                        if(response && response.data && response.data.success){
                            var page = response.data.page;
                            self.tableData = page["dataList"];
                            self.totalCount = page["totalCount"];
                        }
                    }).catch(function (error) {
                        self.vloading = false;
                        console.log(error);
                    });
                },
                startGetMovie:function(){
                    var self = this;
                    self.vloading = true;
                    var url = "/movie/startDownloadMovie";
                    axios.post(url).then(function (response) {
                        self.vloading = false;
                        if(response && response.data && response.data.success){
                            self.$message("后台处理中,稍后刷新页面!");
                        }
                    }).catch(function (error) {
                        self.vloading = false;
                        console.log(error);
                    });
                },
                handleSizeChange:function(val){
                    this.pageSize = val;
                    this.queryDataForPage();
                },
                handleCurrentChange:function(val){
                    this.currentPage = val;
                    this.queryDataForPage();
                },
                deleteAllMovie:function(){
                    var self = this;
                    self.vloading = true;
                    var url = "/movie/deleteAllMovie";
                    axios.post(url).then(function (response) {
                        self.vloading = false;
                        if(response && response.data && response.data.success){
                            self.$message("删除成功!");
                            setTimeout(self.queryDataForPage(),500);
                        }
                    }).catch(function (error) {
                        self.vloading = false;
                        console.log(error);
                    });
                }
            }
        });
    </script>
</html>